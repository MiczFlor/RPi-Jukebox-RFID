version: "3.9"

services:
  jukebox:
    build:
      context: .
      dockerfile: jukebox.Dockerfile
    container_name: jukebox
    environment:
      - PULSE_SERVER=docker.for.mac.localhost
    ports:
      - "8080:80"
    links:
      - mpd
    tty: true
    volumes:
      - ./Phoniebox:/home/pi/RPi-Jukebox-RFID/Phoniebox
      - ./shared/audiofolders:/home/pi/RPi-Jukebox-RFID/shared/audiofolders
      # For Mac
      - ~/.config/pulse:/root/.config/pulse 
      - /usr/local/Cellar/pulseaudio/14.2/etc/pulse/:/etc/pulse
  
  webui:
    build:
      context: .
      dockerfile: webui.Dockerfile
    container_name: webui
    ports:
      - "8000:80"
    restart: unless-stopped
    tty: true
    volumes:
      - ./htdocs:/home/pi/RPi-Jukebox-RFID/htdocs

  mpd:
    build:
      context: .
      dockerfile: mpd.Dockerfile
    container_name: mpd
    # devices:
    #   - /dev/snd
    environment:
      - PULSE_SERVER=docker.for.mac.localhost
    ports:
      - "6600:6600"
      - "8800:8800"
    restart: unless-stopped
    volumes:
      - ./shared/audiofolders:/root/.config/mpd/music:rw
      - ./shared/playlists:/root/.config/mpd/playlists:rw
      - ./docker-development/config/docker.mpd.conf:/root/.config/mpd/mpd.conf:rw
      # For Mac
      - ~/.config/pulse:/root/.config/pulse 
      - /usr/local/Cellar/pulseaudio/14.2/etc/pulse/:/etc/pulse